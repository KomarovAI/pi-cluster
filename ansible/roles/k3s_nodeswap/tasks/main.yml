---
- name: Ensure K3s config directory exists
  ansible.builtin.file:
    path: /etc/rancher/k3s
    state: directory
    mode: '0755'

- name: Create K3s server config with NodeSwap support
  ansible.builtin.template:
    src: k3s-server-config.yaml.j2
    dest: /etc/rancher/k3s/config.yaml
    mode: '0644'
  when: "'k3s_master' in group_names"
  notify: restart k3s

- name: Create K3s agent config with NodeSwap support
  ansible.builtin.template:
    src: k3s-agent-config.yaml.j2
    dest: /etc/rancher/k3s/config.yaml
    mode: '0644'
  when: "'k3s_worker' in group_names"
  notify: restart k3s-agent
